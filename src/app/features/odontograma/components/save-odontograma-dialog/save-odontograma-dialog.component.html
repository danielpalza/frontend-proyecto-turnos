<div class="modal fade show d-block" *ngIf="open">
  <div class="modal-backdrop fade show" (click)="close()"></div>

  <div class="modal-dialog modal-xl">
    <div class="modal-content">

      <!-- Header -->
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-floppy me-2"></i>Guardar Odontograma
        </h5>
        <button type="button" class="btn-close" (click)="close()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body">

        <form (ngSubmit)="handleSubmit()">

          <div class="row">
            <!-- Columna izquierda (Formulario de Pago) -->
            <div class="col-lg-6 pe-lg-4 scroll-section">

              <h6 class="border-bottom pb-2 mb-3">
                <i class="bi bi-cash-coin me-2 text-primary"></i>Detalles de Pago
              </h6>

              <div class="mb-3">
                <label class="form-label">Precio de Bono</label>
                <input type="number" class="form-control"
                  [value]="formData().precioBono"
                  (input)="updateField('precioBono', $any($event.target).value)">
              </div>

              <div class="mb-3">
                <label class="form-label">Precio de Tratamiento</label>
                <input type="number" class="form-control"
                  [value]="formData().precioTratamiento"
                  (input)="updateField('precioTratamiento', $any($event.target).value)">
              </div>

              <div class="mb-3">
                <label class="form-label">Extras</label>
                <input type="number" class="form-control"
                  [value]="formData().extras"
                  (input)="updateField('extras', $any($event.target).value)">
              </div>

              <div class="mb-3">
                <label class="form-label">Monto de Pago del Cliente</label>
                <input type="number" class="form-control"
                  [value]="formData().montoPago"
                  (input)="updateField('montoPago', $any($event.target).value)">
              </div>

              <!-- Totales -->
              <div class="mt-4 pt-3 border-top">
                <div class="d-flex justify-content-between p-3 bg-light rounded mb-2">
                  <span>Total:</span>
                  <strong>$ {{ calcularTotal() }}</strong>
                </div>

                <div class="d-flex justify-content-between p-3 bg-indigo-light rounded border border-indigo">
                  <span class="text-primary">Resto a Pagar:</span>
                  <strong class="text-primary">$ {{ calcularResto() }}</strong>
                </div>
              </div>

              <div class="mb-3 mt-3">
                <label class="form-label">Observaciones de Pago</label>
                <textarea rows="3" class="form-control"
                  [value]="formData().observacionesPago"
                  (input)="updateField('observacionesPago', $any($event.target).value)">
                </textarea>
              </div>

              <div class="mb-3">
                <label class="form-label">Observaciones Profesional</label>
                <textarea rows="4" class="form-control"
                  [value]="formData().observacionesProfesional"
                  (input)="updateField('observacionesProfesional', $any($event.target).value)">
                </textarea>
              </div>

            </div>

            <!-- Columna derecha: Resumen -->
            <div class="col-lg-6 scroll-section bg-soft p-4 rounded">

              <h6 class="mb-3">
                <i class="bi bi-clipboard2-pulse me-2 text-primary"></i>Resumen del Odontograma
              </h6>

              <!-- Leyenda -->
              <div class="bg-white rounded p-3 shadow-sm mb-4">
                <p class="fw-semibold mb-2">Leyenda de Estados:</p>

                <div class="row g-2 small">
                  <div class="col-6 d-flex align-items-center gap-2">
                    <div class="legend-box border"></div> <span>Sano</span>
                  </div>
                  <div class="col-6 d-flex align-items-center gap-2">
                    <div class="legend-box bg-danger"></div> <span>Caries</span>
                  </div>
                  <div class="col-6 d-flex align-items-center gap-2">
                    <div class="legend-box bg-primary"></div> <span>Obturación</span>
                  </div>
                  <div class="col-6 d-flex align-items-center gap-2">
                    <div class="legend-box bg-secondary"></div> <span>Ausente</span>
                  </div>
                </div>
              </div>

              <div class="bg-white p-3 rounded shadow-sm">
                <p class="fw-semibold mb-2">Estado Dental Actual:</p>

                <p class="small text-muted">
                  El odontograma muestra el estado actual de todas las piezas dentales del paciente.
                </p>

                <hr>

                <ul class="small ms-3 mb-0">
                  <li>Estado de cada cara dental</li>
                  <li>Presencia de caries activas</li>
                  <li>Obturaciones previas</li>
                  <li>Piezas dentales ausentes</li>
                  <li>Tratamientos realizados</li>
                </ul>

              </div>

              <div class="bg-white p-3 rounded shadow-sm mt-3 small text-muted">
                <strong class="text-dark">
                  <i class="bi bi-lightbulb me-1"></i>Recordatorio:
                </strong>
                <ul class="mt-2 mb-0">
                  <li>Completa las observaciones profesionales</li>
                  <li>Registra los detalles de pago</li>
                  <li>Verifica que el odontograma esté actualizado</li>
                </ul>
              </div>

            </div>
          </div>

          <!-- Footer -->
          <div class="modal-footer mt-4 pt-3 border-top">
            <button type="button" class="btn btn-outline-secondary flex-fill" (click)="close()">
              <i class="bi bi-x-lg me-2"></i>Cancelar
            </button>

            <button type="submit" class="btn btn-primary flex-fill">
              <i class="bi bi-check-lg me-2"></i>Guardar Odontograma
            </button>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>

