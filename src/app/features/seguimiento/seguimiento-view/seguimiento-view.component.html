<div class="seguimiento-container">
  <div class="container-fluid px-4">

    <!-- Título -->
    <div class="header-section mb-4 d-flex justify-content-between align-items-center">
      <div>
        <h1 class="fw-bold mb-0">
          <i class="bi bi-clipboard-data me-2 text-primary"></i>Seguimiento de Pacientes
        </h1>
        <p class="text-muted mb-0">Historial y seguimiento de todos los pacientes</p>
      </div>

      <button
        type="button"
        class="btn btn-primary d-flex align-items-center gap-2"
        (click)="openAddProfesional()"
      >
        <i class="bi bi-person-plus"></i>
        Agregar profesional
      </button>
    </div>

    <!-- Buscador -->
    <div class="mb-4 position-relative search-container">
      <i class="bi bi-search position-absolute top-50 translate-middle-y ms-3 text-muted"></i>
      <input
        type="text"
        class="form-control ps-5"
        placeholder="Buscar por nombre, DNI o email..."
        [(ngModel)]="searchTerm"
      />
    </div>

    <!-- Sin resultados -->
    <div *ngIf="patientGroups.length === 0" class="card empty-state">
      <div class="card-body text-center p-5">
        <i class="bi bi-people fs-1 mb-3 d-block text-muted opacity-50"></i>
        <p class="text-muted mb-0">
          {{ searchTerm ? 'No se encontraron pacientes' : 'No hay pacientes registrados' }}
        </p>
      </div>
    </div>

    <!-- Lista de pacientes -->
    <div class="patients-list" *ngIf="patientGroups.length > 0">

      <div
        *ngFor="let group of patientGroups"
        class="card shadow-sm patient-card mb-4"
      >
        <div class="card-header bg-white">
          <div class="d-flex align-items-center gap-3">
            <div class="avatar">
              <i class="bi bi-person fs-4 text-primary"></i>
            </div>

            <div>
              <h5 class="m-0 fw-semibold">{{ group.patient.patientName }}</h5>
              <small class="text-muted">DNI: {{ group.patient.patientDni }}</small>
            </div>
          </div>
        </div>

        <div class="card-body">

          <!-- Datos del paciente -->
          <div class="row g-3 mb-3 pb-3 border-bottom patient-info">
            <div class="col-md-6">
              <span class="text-muted">DNI:</span>
              <span class="fw-semibold ms-1">{{ group.patient.patientDni }}</span>
            </div>

            <div class="col-md-6" *ngIf="group.patient.patientObraSocialNumero">
              <span class="text-muted">N° Obra Social:</span>
              <span class="fw-semibold ms-1">{{ group.patient.patientObraSocialNumero }}</span>
            </div>
          </div>

          <!-- Historial de turnos -->
          <p class="fw-semibold text-secondary mb-2">
            <i class="bi bi-calendar-check me-2"></i>Historial de turnos ({{ group.appointments.length }})
          </p>

          <div class="appointments-timeline">
            <div
              *ngFor="let app of group.appointments"
              class="timeline-item d-flex align-items-center gap-2 p-2 rounded"
            >
              <i class="bi bi-calendar-event text-primary"></i>
              <span>{{ formatDate(app.fecha) }}</span>
            </div>
          </div>

        </div>
      </div>

    </div>

    <!-- Modal Agregar Profesional -->
    <div
      class="modal fade show d-block"
      tabindex="-1"
      role="dialog"
      *ngIf="showProfesionalForm"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Agregar profesional</h5>
            <button
              type="button"
              class="btn-close"
              aria-label="Close"
              (click)="closeAddProfesional()"
            ></button>
          </div>

          <form #profForm="ngForm" (ngSubmit)="onSaveProfesional(profForm)">
            <div class="modal-body">
              <div class="mb-3">
                <label class="form-label">Nombre y apellido *</label>
                <input
                  type="text"
                  class="form-control"
                  name="nombre"
                  [(ngModel)]="nuevoProfesional.nombre"
                  required
                />
              </div>

              <div class="mb-3">
                <label class="form-label">DNI</label>
                <input
                  type="text"
                  class="form-control"
                  name="dni"
                  [(ngModel)]="nuevoProfesional.dni"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">Especialidad</label>
                <input
                  type="text"
                  class="form-control"
                  name="especialidad"
                  [(ngModel)]="nuevoProfesional.especialidad"
                />
              </div>

              <div class="mb-3">
                <label class="form-label">Matrícula</label>
                <input
                  type="text"
                  class="form-control"
                  name="matricula"
                  [(ngModel)]="nuevoProfesional.matricula"
                />
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label class="form-label">Email</label>
                  <input
                    type="email"
                    class="form-control"
                    name="email"
                    [(ngModel)]="nuevoProfesional.email"
                  />
                </div>

                <div class="col-md-6 mb-3">
                  <label class="form-label">Teléfono</label>
                  <input
                    type="text"
                    class="form-control"
                    name="telefono"
                    [(ngModel)]="nuevoProfesional.telefono"
                  />
                </div>
              </div>

              <div *ngIf="saveProfesionalError" class="alert alert-danger py-2">
                {{ saveProfesionalError }}
              </div>
            </div>

            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-outline-secondary"
                (click)="closeAddProfesional()"
              >
                Cancelar
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="profForm.invalid || isSavingProfesional"
              >
                {{ isSavingProfesional ? 'Guardando...' : 'Guardar' }}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div
      class="modal-backdrop fade show"
      *ngIf="showProfesionalForm"
    ></div>

  </div>
</div>
