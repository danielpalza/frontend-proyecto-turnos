<div class="turnos-view">
  <!-- Mensaje de error general -->
  @if (hasError && errorMessage) {
  <div class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <strong>Error:</strong> {{ errorMessage }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
      (click)="hasError = false; errorMessage = null"></button>
  </div>
  }

  <!-- Indicadores de carga -->
  @if (isLoadingAppointments || isLoadingPatients || isLoadingProfesionales) {
  <div class="alert alert-info" role="alert">
    <div class="spinner-border spinner-border-sm me-2" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <span>Cargando datos...</span>
  </div>
  }

  <div class="main-layout">
    <!-- Calendario -->
    <div class="calendar-section">
      <app-month-calendar
        [currentDate]="currentDate"
        [selectedDate]="selectedDate"
        [appointments]="appointments"
        [profesionales]="activeProfesionales"
        [patients]="existingPatients"
        [showPendingOnlyFilter]="true"
        [pendingOnly]="pendingOnlyFilter"
        (dateClick)="onDateClick($event)"
        (monthChange)="onMonthChange($event)"
        (filterChange)="onFilterChange($event)"
        (pendingOnlyChange)="onPendingOnlyChange($event)"
      />
    </div>

    <!-- Panel de turnos -->
    <div class="panel-section">
      <app-appointments-panel [date]="selectedDate"
        [appointments]="selectedDate ? getAppointmentsForDate(selectedDate) : []" (delete)="onDeleteAppointment($event)"
        (addClick)="onAddAppointmentClick()" />
    </div>
  </div>

  <!-- Dialogo -->
  @if (selectedDate) {
  <app-appointment-dialog [open]="isDialogOpen" [selectedDate]="selectedDate" [existingPatients]="existingPatients"
    [profesionales]="activeProfesionales" [isLoading]="isLoading" (openChange)="onDialogOpenChange($event)"
    (submitForm)="onCreateAppointment($event)" />
  }

  <!-- Modal confirmación eliminación -->
  <app-confirm-dialog [open]="isDeleteConfirmOpen" title="Eliminar turno"
    message="¿Está seguro de que desea eliminar este turno? Esta acción no se puede deshacer."
    [summary]="deleteCandidateSummary" [isLoading]="isDeletingAppointment" confirmText="Eliminar" cancelText="Cancelar"
    confirmButtonClass="btn-danger" dialogId="confirmDelete" (confirm)="confirmDeleteAppointment()"
    (cancel)="closeDeleteConfirm()" (openChange)="onDeleteConfirmOpenChange($event)" />
</div>

<ol>
  <li>Estilos: Cambiar estilos alertas toast para adaptar a los estilos de la app</li> <br>
  <li>Funcionalidad: Agregar funcionalidad para editar profesionales en los turnos</li>
</ol>

<!-- <div class="debug-info">
  <h3>Debug Info</h3>
  <p>selectedDate: {{ selectedDate }}</p>
  <p>appointments: {{ appointments.length }}</p>
  <p>patients: {{ existingPatients.length }}</p>
  <p>profesionales: {{ activeProfesionales.length }}</p>
  <p>pendingOnlyFilter: {{ pendingOnlyFilter }}</p>
</div> -->