<div class="turnos-view">
  <!-- Mensaje de error general -->
  @if (hasError && errorMessage) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      <strong>Error:</strong> {{ errorMessage }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" (click)="hasError = false; errorMessage = null"></button>
    </div>
  }

  <!-- Indicadores de carga -->
  @if (isLoadingAppointments || isLoadingPatients || isLoadingProfesionales) {
    <div class="alert alert-info" role="alert">
      <div class="spinner-border spinner-border-sm me-2" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <span>Cargando datos...</span>
    </div>
  }

  <div class="main-layout">
    <!-- Calendario -->
    <div class="calendar-section">
      <app-month-calendar
        [currentDate]="currentDate"
        [selectedDate]="selectedDate"
        [getAppointmentsForDate]="getAppointmentsForDate"
        (dateClick)="onDateClick($event)"
        (monthChange)="onMonthChange($event)"
      />
    </div>

    <!-- Panel de turnos -->
    <div class="panel-section">
      <app-appointments-panel
        [date]="selectedDate"
        [appointments]="selectedDate ? getAppointmentsForDate(selectedDate) : []"
        (delete)="onDeleteAppointment($event)"
        (addClick)="onAddAppointmentClick()"
      />
    </div>
  </div>

  <!-- Dialogo -->
  @if (selectedDate) {
    <app-appointment-dialog
      [open]="isDialogOpen"
      [selectedDate]="selectedDate"
      [existingPatients]="existingPatients"
      [profesionales]="activeProfesionales"
      [isLoading]="isLoading"
      (openChange)="onDialogOpenChange($event)"
      (submitForm)="onCreateAppointment($event)"
    />
  }
</div>

<ol>
  <strong>Primer modelo:</strong>
  <li>
    Al crear/editar turno: <br>
    - Verificar que
    el horario este libre <br>
    - Prevenir superposici√≥n <br>
    - Bloquear horarios pasados <br>
    - EDITAR/REPROGRAMAR EL TURNO <br>
    - PASAR MATEMATICAS DEL CONTEO DEL PAGO DEL TURNO AL BACKEND
  </li>
  <li>
    Seguimiento/Historial del paciente: <br>
    - Ver odontogramas asociados al turno <br>
    - Estado del pago de los turnos o modal mostrando seguimiento de pagos <br>
    - EDITAR DATOS DEL PACIENTE
  </li>
  <li>
    En el calendario mensual de turnos:
    - Filtrar por profesional <br>
    - Filtrar por paciente <br>
    - Filtrar por pagos pendientes por pagos pendientes <br>
    - Mostrar profesionales de vacaciones
  </li>
</ol>
